<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/dist/aframe-master.js"></script>
    <script src="https://unpkg.com/aframe-ambisonic-component"></script>
  <script src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/aframe-ambisonic-component-master/examples/scripts/play-on-window-click.js"></script>
    <style type="text/css">
        .ctrl-btn button {
            width:80px;
        }
     .progress {
            width: 100%;
            appearance: none;
            border-radius: 5px;
            height: 5px;
            background: #d3d3d3;
            outline: none;
        }
        #video {
            display:inline;
        }
    </style>
    <script text="javascript" src="js/molmediasync.js"></script>
    <script type="module">
        
        import {
                TimingObject,
                TimingSampler,
                TimingProgress
            } from "https://webtiming.github.io/timingsrc/lib/timingsrc-esm-v3.js";

        // timing object
        const to = new TimingObject({range:[0,209]});
        
        //ambisonic test
       // var aO = document.getElementById('a1');
       // aO.crossOrigin = "anonymous";
      //  var ambi = document.getElementById('ambisonic');
      //  console.log(ambi);
     //   var components = this.el.components;

        // Hook up buttons UI
        document.getElementById("reset").onclick = function () {
            to.update({position:0});
            to.update({velocity:0});
           
        };
        document.getElementById("pause").onclick = function () {
            to.update({velocity:0});

        };
        document.getElementById("play").onclick = function () {
            to.update({velocity:1});
           // ambi.components.ambisonic.playSound();
           // aO.play();

        };
       /* document.getElementById("reverse").onclick = function () {
            to.update({velocity:-1});
        }; */

        // refresh position every 100 ms
        const sampler = new TimingSampler(to, {period:100});

        // position
        const pos_elem = document.getElementById("position");
        sampler.on("change", function () {
            pos_elem.innerHTML = `${to.pos.toFixed(2)}`;
        });

        // progress
        const progress_elem = document.getElementById("progress");
        const progress = new TimingProgress(to,
                                            progress_elem,              {sampler:sampler});
        
        // Set up video sync
        const sync1 = MCorp.mediaSync(document.getElementById('v1'), to);

        // Set up video sync
        const sync2 = MCorp.mediaSync(document.getElementById('v2'), to);
        
        // Set up audio sync
       // const sync3 = MCorp.mediaSync(document.getElementById('a1'), to);

        window.to = to;
        
        

    </script>


</head>
<body>
    <p>
       <!-- <div>
            Position: <span id="position" style="color:red;"></span>
        </div> -->
        <div class="ctrl-btn">
            <button id="reset">Stop</button>
            <button id="play">Play</button>
            <button id="pause">Pause</button>
           <!-- <button id="reverse">Reverse</button> -->
        </div>
    </p>
   <p>
        <input type="range" min="0" max="100" value="0" id="progress" class="progress">
    </p>
</body>
<style>
 #embeddedScene {
   width:100%;
   height:800px;
 }
</style>
<div id="embeddedScene">
<a-scene embedded loading-screen="backgroundColor: black" background="color: black" start>
 <a-assets timeout="100">
    <video id="v1" autoplay crossOrigin="anonymous">
        <source src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/assets/ICU_1.webm" type="video/webm" />
        <source src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/assets/ICU_1.mp4" type="video/mp4" />
    </video>
    <video id="v2" autoplay crossOrigin="anonymous">
        <source src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/assets/ICU_2.webm" type="video/webm" />
        <source src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/assets/ICU_2.mp4" type="video/mp4" />
    </video>
  <audio id="a1" crossorigin="anonymous" preload="auto" src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/assets/audio/1.ogg">
        </audio>
   
   <!--   <audio id="a1" crossorigin="anonymous" preload="auto">
       <source src="https://cdn.jsdelivr.net/gh/mmonahan333/ICU/assets/audio/combined.ogg">
           </source>
        </audio>-->
</a-assets>
 <a-entity id="camera" camera wasd-controls look-controls position="0 0 0" ></a-entity>
 <!-- <a-entity  id="a1p" position="-8 0 -12" sound="src: #a1">
 </a-entity> -->
 <a-ambisonic
     id="ambisonic"
     src="#a1"
     order="3"
     channel-map="FuMa"
     play-on-window-click
 ></a-ambisonic>
 <a-entity material="shader: flat; src: #v1" geometry="primitive: plane; width: 160; height: 90;" position="-160 0 -240" rotation="0 0 0" ></a-entity>
 <a-entity material="shader: flat; src: #v2" geometry="primitive: plane; width: 160; height: 90" position="0 0 -240" rotation="0 0 0" ></a-entity>
</a-scene>
</div>
 </body>
</html>
